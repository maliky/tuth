#+TITLE: Tuth program

* Tuth Application â€” Quickstart Guide

This document summarizes how to explicitly run and test the Tuth application in different environments.
** The apps
Here are the different applications you will find in this directory
- Registry for documents, registrations, class rosters
- Spaces for building and room
- Academics for courses, curricula, colleges and prerequisites
- Timetable for reservations, semesters & schedule definitions
- People for role and user profile  
- Finance for payements, scholarship and financial_records.


** Development Environment
To make some change :
- Create a new branch or switch to dev branch
- Do you changes
If adding python libraries (through `pip install ...`)
- add them to requirements-dev.txt
#+BEGIN_SRC bash  
echo "xyz" > requirements-dev.txt
#+END_SRC
- Do code checks with 
#+BEGIN_SRC python
black app/ && flake8 app/ && mypy app/
#+END_SRC
*** Test
You can run `./run.sh -m` to start a fresh test on the local machine. (you need python requirements*.txt to be installed).
in a second terminal populate your db with a file having this structure
#+BEGIN_VERBATIM
academic_year: 25-26
semester: 1 
college: CAFS
course_code: AGR
course_no: 121
course_long_code: AGR121-CAFS
course_title: Practicum I
credit_hours: 1
curriculum: Bsc Agriculture
section: 1
location: SAPEC-SAPEC
space: SAPEC
room: SAPEC
faculty: Prof A
weekday: Friday
start_time: 9:00
end_time: 10:00
#+END_VERBATIM
Check the run.sh script to check where to put th file.

*** Launch your docker-compose dev environment
You can review the Dockerfile-dev and the docker-compose-dev.yml file and then build the Docker environment.
#+begin_src bash
docker-compose -f docker-compose-dev.yml up --build
#+end_src

*** Running Tests 
**** Localy

Explicitly run tests within the dev container:

#+begin_src bash
docker-compose -f docker-compose-dev.yml run --rm web pytest tests/
#+end_src

Access explicitly at [[https://localhost][https://localhost]]

*** Restarting from fresh
#+BEGIN_SRC bash term2
  docker-compose -f docker-compose-dev.yml down -v
  sudo rm app/migrations/*
#+END_SRC

In another terminal
#+BEGIN_SRC bash term2
   docker-compose -f docker-compose-dev.yml up --build
#+END_SRC

#+BEGIN_SRC bash  term3
    docker-compose -f docker-compose-dev.yml exec web python manage.py makemigrations app
    docker-compose -f docker-compose-dev.yml exec web python manage.py migrate
    docker-compose -f docker-compose-dev.yml exec web python manage.py populate_initial_data
#+END_SRC



** Production Environment

Build and launch explicitly the production environment:

#+begin_src bash
docker-compose -f docker-compose-prod.yml up --build -d
#+end_src

- Ensure that your production `.env-prod` file is explicitly configured and secure.

Access explicitly via your production URL (e.g., [[https://tuth.koba.sarl][https://tuth.koba.sarl]]).

** Data Import/Export

Several admin screens expose Import and Export buttons powered by
the =django-import-export= package. Use these buttons to upload CSV
or XLSX files and to download existing records. Models such as
Courses, Curricula and Sections already provide corresponding
resources.


** Importing a full workbook
Use ``import_workbook`` to load an Excel file containing
``timetable``, ``academics``, ``people`` and ``spaces`` sheets.

# +begin_src bash
python manage.py import_workbook myfile.xlsx --dry-run
# +end_src
Run the command without ``--dry-run`` to persist changes.
