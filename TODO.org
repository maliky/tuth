* DONE <2025-11-12 mer. 23:55> Dev to prod
CLOSED: [2025-11-13 jeu. 00:19]
You are on a pre-prod env.  and I want to use postgresql here, things that is not possible on my local dev env.  I also want to serve the website using nginx but behind a .htaccess taht I know will block the access to the pages at server level unless the password is known.  I know that is is slightly risqu but no other software runs on this preprod and I a ready to move on with this setup.

Can you give me a plan of action and deployment.
Will I gain a lot in efficiency if I use native postgresql / nginx compared to dockerized versions ? if not propose some docker-compose for the pre-prod.
** Preprod Stack

- Added a dedicated Docker stack that wires Postgres, the Django/Gunicorn app, and an Nginx reverse proxy with shared volumes plus env-file anchoring in docker-compose-preprod.yml:1.
- Created the deploy/preprod/entrypoint.sh:1 bootstrap script so the web container waits for Postgres, runs migrate, collects static files, and exposes Gunicorn via a Unix socket.
- Defined the locked-down Nginx layer (static/media aliases, /healthz, and HTTP Basic Auth) in infra/preprod/nginx/conf.d/tusis.conf:1, plus an ignored htpasswd   placeholder to mimic the requested “.htaccess” gate in infra/preprod/nginx/htpasswd.example:1.
- Published a .env-preprod.example:1 template that carries all Django and database settings along with Gunicorn tunables used by the new stack.
- Documented the full pre-prod rollout steps (secrets, htpasswd generation, stack bring-up, smoke tests, maintenance, optional TLS) in README.org:169.
- Tests: not run (not requested).

** Next Steps
1. Copy .env-preprod.example to .env-preprod, fill in real secrets/hosts, and keep it off git.
2. Generate infra/preprod/nginx/htpasswd with htpasswd -c … (or similar) so Nginx can enforce the password gate.
3. Run docker-compose -f docker-compose-preprod.yml up -d --build, tail docker-compose … logs -f web nginx, and hit http://<host>/healthz with your credentials to verify before handing out access.


* <2025-11-12 mer. 14:23>

  Hierachy of roles through academic standing.
  Faculty teach courses own by a department and exceptionaly by a college directly.  A faculty can be working in several department. The model need to be update to take this in account.

  A chair is a normal faculty but been part of the chair group.  A chair is assigned to one department therefore a chair can list the faculty giving course in his department.  He could have acces to the dashboard of this faculties for the courses pertaining to his departement, but let's leave that for now.  The structure between dean and chair is cleaner or between dean and VPAA.  In any case this role hierchy and dashboard access is not a priority. so let's drop it for now.   Identify in the rest of the prompt what can be done that isnt linked to that. hiearchy role
  
Expand the view_routing_map2 as view_routing_map3 in journal explicitly showing the role_name found in the perms file.  Find a way to display the hierachy structure of roles among the users.  All the staff roles have now acces to /admin/ do not clutter the graph with too many arrows, but it should be clear that they all have access to this screen (what's the correct technical name?)  Is is possible to concentrate the arrows into one or to make the arrow go from the emcopassing rectangle grouping several screen to show that all can go to that other screen ?

 Dean should have access to their chair dashboard a be able to list there chairs.
 Department Chairs shold be able to access their faculty dashboard and list them also.
 Let the rule be that a higer role can access the dashboard of the directly lower role but not more, and that he should be able to list all the dashboard he can have access too.

In the error page remove the link going back to login. Replace it with a link to the Landing.

I do not see the difference between staff/dashboard and staff/<role> ?
Isn't there some redunduncy there ?

*** Enrollement
- The card (what is the actual professional UX name?) enabeling to edit a specify student should incorporate an autocomplet search field enabling direct selection of the student to dive into without passing through a intermediary scree.  The autocomplet search form should use student id and name as search keys. Since this is enrollement it should exclude student who have graduated already.
  
  

* <2025-11-12 mer. 14:12> Admin functionnalities
  Make sure that when a role has view access to a modle, he can also use the search field in the admin interface as this one can depend on rights on some of the model fk that may not have been granted.  This should be corrected so that the search view can function for any role having view right on it.

* DONE <2025-11-12 mer. 11:37> UX Work
  CLOSED: [2025-11-12 mer. 14:00]
Propose a detailed plan to cover the elements below. I will give you full access so you can run the selenium test.

1. Create standard http client error pages (400, 401, 403, 404, 408, 429) with user friendly messages.
2. Update journal.org view_routing_map with an the exaustive list of roles, screens, dashboard provided at present.
3. Change the dashboard theme from dark to light theme but keep the general sytle aligned with WVSTU design guidelines. The theme used in registrar/course-windows/ is good.  Apply the new style to every staff page including for example /students /students/new
4. On all staff dashboard there should be a button to go to django admin interface (like in registrar/course-windows/ and staff/registrar_officer/ ) and the django admin interface a button to go the the role dashboard (if available). I appreciate the 'Audit statuses directly in Django admin'. Apply the same patern in other similar places.
5. in /auth/login  Write a less technical campus brief
6. remove the links to different surfaces
7. <2025-11-11 mar.> Enrollement Officer UX
   - You can remove the search and filter accross cohort. A link to the django admin exists and permits this filtering already.
   - Remove the "create student action" form, just link to django admin student creation.
   - Add a link to django admin student edition. This should have a field to select the student ID and take the enrollement directly to the student edition form in django adming.
8. Hiearchy : <role>_officer, should be able to see the dasboard of <role> eg. dashboard/registrar_officer should be able to acces dashboard/registrar.
9. create tests if core logic changed
   
#  At the creation of a student it's password should be his newly generated student id. but in the backend, create the student and then update his password to his student id.

** • Implemented the full UX revamp across staff and portal surfaces.
  - Introduced a shared light-theme staff shell (app/website/templates/website/staff/base.html + app/website/static/css/staff-dashboard.css) and rebuilt every staff dashboard (app/website/templates/website/staff/role_dashboard.html) plus registrar/enrollment screens to match the WVSTU style, complete with admin CTA in the header and breadcrumb/navigation chips (e.g., app/website/templates/enrollment/*.html, app/website/templates/website/registrar_windows.html). All enrollment flows now push officers into Django admin via new action cards and the student_admin_edit helper view (app/website/views/enrollment.py, app/website/templates/enrollment/student_admin_edit.html, app/website/urls.py).
  - Added a friendly error system with templates/services for 400/401/403/404/408/429 (app/website/views/errors.py, app/website/templates/errors/generic.html) and wired the handlers in app/urls.py.
  - Updated staff routing logic so officer roles inherit access to their base dashboards and added admin ↔ dashboard shortcuts via a templated button (templates/admin/base_site.html, app/website/templatetags/staff_extras.py, app/website/views/staff_dashboards.py). Enrollment/finance action cards were refreshed to reference admin workflows instead of in-app forms.
  - Gave /auth/login and admin login a campus-friendly brief and removed the “different surface” links (app/website/templates/website/portal_login.html, templates/admin/login.html). The journal.org routing map now lists every role/screen combination.
  - Added regression tests covering the new error handlers, officer access, and the Selenium smoke suite for the updated dashboards (tests/website/test_error_pages.py, tests/website/test_staff_permissions.py, tests/selenium/test_portal_roles.py).
   
* <2025-11-11 mar. 23:03>  The student entry in the system
When a potential candidate wants to enter WVSTU it first need to pay some fees for the entrance exams.  This is recorded at the finance office.  When it is recorded the finance creates a student with minal information.  Full name and date of birth.  this should be enought to distinguish student.  The system creates the student id and student object, set the default password (student id).

The student then goes to the enrollement who add some other information including, curriculum, college, school attended ect... and a photo enabeling to print a small passport with name and photo to take the entrance exam.

Until the student succeed his entrance exams he cannot obviously register for courses. but he can acces his dashboard where his profil should be accessible in case of correction or to enrich it with non mandatory informations.

  

  
* Need to work on data wrangling <2025-11-11 mar. 21:33>
* <2025-11-11 mar. 21:26> in [[file:journal.org::*<2025-11-11 Tue 19:59> Role hierarchy sketch][<2025-11-11 Tue 19:59> Role hierarchy sketch]]
Why did you introduce a General Workspace ?
How do we call the different rectangle generated by planuml ?
What is the exact nature of the arrows ? if it is hiearchy then VPAA should inheringte staff (base), but I don't think it is hierachy still I am trying to understand why is staff base connected to the lowest rank roles only ?


- I labeled that lowest layer “General Workspace” to represent the fallback staff dashboard we route to when a user isn’t in any specific group. It isn’t a new business role—just the generic /staff/dashboard/ experience—so we can rename it or drop the box if that’s confusing.
- In PlantUML each box is just a node; I used [Label] (plain rectangles) rather than rectangle "…" { … } groups. We can adopt consistent wording like “Role Node” or convert to package/rectangle blocks if you prefer a more obvious legend.
- The arrows were meant to show “has access to” / “inherits workspace from” rather than org-chart reporting. So VPAA’s arrow to “Staff (base)” gestured to “VPAA users also get the standard staff workspace,” and the arrows from Staff to other entries hinted that the base workspace sits alongside those role-specific ones. If you’d rather show a strict hierarchy, we can switch to UML generalization (triangle arrowheads) or rework the diagram to separate capability inheritance from reporting lines—just let me know which visual style you want.

*** TODO Need to be reworked  
* DONE <2025-11-11 mar. 22:52> Charting preferences
  CLOSED: [2025-11-11 mar. 23:02]
 Important note. I am confortable with vega, vega-lite and d3js, so you I prefere those js librairy for charting when necessary

* DONE <2025-11-11 mar. 22:14> change password for test_users
  CLOSED: [2025-11-11 mar. 22:20]
  Passw0rd! or PassW0rd!

* DONE <2025-11-11 mar. 20:58> correct dashboard test
  CLOSED: [2025-11-11 mar. 21:20]
you have full acces to run selenium test.  The issue you get is because somehow you introduce code that use wbm 114 driver which is not compatible with my browser version.  the version 142... is also installe on the system and should always be used.  update the code to do that and add a note maybe in AGENTS to avoid code regression later.
* <2025-11-11 mar. 18:36> adding dashboard for roles
  I logged in as a registrar and go to the staff/dashboard but showing the registrar dashboard. that is ok.  I then tried to acces http://127.0.0.1:8000/registrar/course-windows I was denied access. This is ok because a simple registrar must not have autorisation to change the semester.  But you need to create the dashboard for all the roles present in app/shared/auth/perms.py
  You should use role hiearchy,  officer / non officer to build  dashboard functionalities for non officer that can be accessed by officer by not vice versa.  keep the separation for faculty chair dean vpaa for usability concerns.  finance and cashier are both under finance officer, staff is the most basic role. it can acces his own information and update it if necessary.
* <2025-11-11 mar. 18:36>
 finaly connect the urls of enrollements tools and registrar tool into there respective dashboard.

* TODO <2025-11-11 mar. 18:37> harmonise design
 Look at  [[file:Docs/tu-web-design-guide.org][Tusis Web Design Guide]] to propose Staff/django dashboard following same general theme and styles.  Propose a color variation to mark that we are in the admin but  keep the mobile-first approach for the student dashboard.  You should drop that constraint for staff dashboards.
Add your style guideline for the student and the staff dashboard  in 2 new entries in tu-web-design-guide.org
  
* Main redirection from same login page 
** Student
   What is proposed is acceptable

** Financial Services
Can consult the financial status of any student,
They can clear a student payment
They keep track of atttachement justifying payments
They validate the payement so the student can proceed to registration

** Registration
They print class roster
They open /close grade input timeframe for faculty
They can edit any grades
They print grade sheets
They validated the registration of student to section (before they appear on official class roster or can receive a grade for the section)

** Enrollment
They create students
   
** Faculties

** Admin (VPAA, President)

* DONE The student_dashboard preview is good connect it to the backend.
  CLOSED: [2025-11-09 Sun 22:11]

* TODO We need to add a link for a student to print / display his grade sheet for the current semester.
* DONE Login in with a testest student user in django admin
  CLOSED: [2025-11-09 Sun 22:13]
** DONE redirect to the student dashboard directly not to django admin
   CLOSED: [2025-11-09 Sun 22:12]

* About some rights for users
** test_enrollment_officer
Curriculum
Current enrolled semester should be the same with entry semester

** student
a student should not be able to see all Academics
nor the list of all students or registration...  it should not be a staff

in the url courses for a student x, following the curriculum BBA Banking and Finance, we should list only the courses from his curriculum, and eventualy electives preselected by the college or curriculum head.   This electives will be marked as elective courses in the curriculum. Should be listed only courses respecting for which the studen has fullfilled the prerequisites (nb credit hours, completed previous courses...)

students listing should not be accessible a a student.

test_student
testest -> T-pass-T!  : tusistusis : ?

*** action
When loggin in an identified student should reach his dashboard
new enrolled student
- showing basic info for the student (name, id, academic year, curriculum)
menu entries on the left hand side
**** Course Registeration
- been show a list of course with  status
- should be in the form of a table or well aligned
  course shortname/code ; course title; status (registered, pending, completed, abandoned ) with date of last status change or date ofr completion grade if applicable, credit hours and semester.
- Another menu should bring the form to register a new course
in that form a summary of the student information related to the registrationm
a list of course code previsouly completedm a field shoing the number of credit hours completedm at the bottom o fthe page an image or a link to the curriculum plan
in the middle the form where the student can selecte in a drop down list a course from the curriculum.
it is supposed that this course has already been schedule so the schedule should be displayed also... Another way and better ui would be to displya the list of available courses to the student drwn from the curriculum, each with a checkbox inf front for slection, and a few important detila to help the slection process.  A ligne should have course title, code, credit hoursm scheldule and a check box to be selected. It would be ok also to have the other courses of the curriculum listed but grayed out with a reminder of the prerequisites.  and I am forgetting to also list the fee attached toeach course (only for available courses as courses price will vary from one semester to another)  .

As the student selects courses to regsiterm I want the his credit hours blaance to diminish accordingly and also the finalcnial balance to be updated.

It should be clear that the student is making a reservation for the course and the his place will be garentied once the payment has been received.  That reminds me that in each line their should be a number for the number of seat avaialbel lein total and remaining.  I said course but it is rather in front o each section.

In fact I see the course listed in plain and then for each a drop down list with the sections schedule and the available seats next to it.  The stduent slecte the section is ithis is taken as chekcing the box for a registration. so remove the registration checkbox...

*** Student dashboard UX
- `website/student_portal_base.html` + `student_dashboard.html` power the new layout; styling/JS live in `student_portal.css` and `student_dashboard.js`.
- `/student/dashboard/` (view: `student_dashboard` in `app/website/views.py`) now pulls real student data: registrations, curriculum courses, sections, prereq checks, credit math, invoices/payments, and grades.
- Credit/fee counters update live from actual seat selections; seat counts and section schedules reflect `Section` + `SecSession` records.
- Next: hook the “Save reservation” and “Proceed to payment” buttons to real workflows and enforce role-based access before launch.
   
* DONE About the website
  CLOSED: [2025-11-09 Sun 22:13]
I want to personnalize the django admin/login form
depending on the username I want to redirect to either normal admin, or to student
I also want to change the them of the admin login form, change the title
 
* 2025
** 2025-11 novembre

*** 2025-11-08 samedi
**** DONE for the semester registration opening
     CLOSED: [2025-11-08 sam. 00:39]
     :PROPERTIES:
     :age:      [2025-11-08 sam. 00:15]
     :origin:   [[file:/mnt/backup/Jobs/TU/DRID/TII-Technics-Innovations/Tusis/Tusis_app/app/timetable/models/semester.py::"""Semester module."""]]
     :END:

It would be better to add a status in the semester model using existing mixing and leveraging constructed used in other files to manage status, status validation and tracking of historical changes.  Remove the class that you added, implement the strategy I propose and make sure the code is cohernet witht the proposed changes.
**** TODO student dashboard ux
     :PROPERTIES:
     :age:      [2025-11-08 sam. 00:37]
     :origin:   [[file:/mnt/backup/Jobs/TU/DRID/TII-Technics-Innovations/Tusis/Tusis_app/TODO.org::*for the semester registration opening][for the semester registration opening]]
     :END:

in the list of courses order the one available to the student at the top of the list, the other should be under a colapsed title called somehting like locked courses, or not yet available courses.     
**** TODO Add columns to the semester admin table 
     :PROPERTIES:
     :age:      [2025-11-08 sam. 00:42]
     :origin:   [[file:/mnt/backup/Jobs/TU/DRID/TII-Technics-Innovations/Tusis/Tusis_app/app/timetable/admin/registers/core.py::"""timetable.Core module."""]]
     :END:

On column should indicate the number of students enrolled in that semester.
Another should indicate the number of sections in that semester
for both the number should be clickable and take the user 1 to the list of students, 2 to the list of sections for that semesters
**** TODO implementing Reservation
     :PROPERTIES:
     :age:      [2025-11-08 sam. 01:00]
     :origin:
     :END:

The idea is to use the registration status workflow from
Pendingm financialy clearedm registrar cleared.  but detail of the workflow can be found in mwe.org file.

In this task you should implement the action when the student clics on reservation after selecting a few courses.
**** TODO Extending tests with course registration
     :PROPERTIES:
     :age:      [2025-11-08 sam. 01:03]
     :origin:   [[file:/mnt/backup/Jobs/TU/DRID/TII-Technics-Innovations/Tusis/Tusis_app/app/timetable/admin/registers/core.py::url = (]]
     :END:

Extend the mockup test and aat bu generating more profile of student.
you will need to generate an student with a history of 2 or 4 semester behind him to be able to test complex prerequisits.
**** TODO Extending tests of students
     :PROPERTIES:
     :age:      [2025-11-08 sam. 01:05]
     :origin:   [[file:/mnt/backup/Jobs/TU/DRID/TII-Technics-Innovations/Tusis/Tusis_app/app/timetable/admin/registers/core.py::url = (]]
     :END:

*** 2025-11-09 dimanche
**** DONE improve login page
     CLOSED: [2025-11-09 Sun 13:54]
     :PROPERTIES:
     :age:      [2025-11-09 dim. 13:42]
     :origin:   [[file:/mnt/backup/Prog/Python/Crypto/kolaBiBot/JOURNAL.org::*<2025-11-09 dim.> This is some infromation for codex.][<2025-11-09 dim.> This is some infromation for codex.]]
     :END:
Explain:
1. the left side page in login page
2. Why option for different surface? Student dashboard, Staff workspace, Administrator console if redirection when connected ?
3. how to test a username passord for one of my test student testest I've reset it password but i cannot connect still ? Do I need to restart the server ? strange..

Answers:
2. The quick links are still helpful because the page can be bookmarked or reached when users are already authenticated; if the redirect target cannot be derived (e.g., group misconfiguration) the buttons offer manual navigation. They also help UX reviewers confirm each surface exists during mock testing.
3. Password resets do not require a server restart. To guarantee a known credential for `testest`, run `python manage.py changepassword testest` or use the shell:
   ```python
   from django.contrib.auth import get_user_model
   User = get_user_model()
   u = User.objects.get(username="testest")
   u.set_password("T-pass-T!")
   u.save()
   ```
   Ensure the user is `is_active=True` and not locked by login throttling. If login still fails, check the server logs for auth backends or group-based redirects denying access.
**** DONE student dashboar
     CLOSED: [2025-11-09 Sun 22:14]
make sure that if a student select courses totalying more than his aloowed creditm they he cannot make the reservations.
Also is the reservation is canceld (he should be able to cancel a reseravation meaning that while prpendingm the studnet should still this the course and have the possibilityh oto cancel the resravation) in taht case the credit and money should be resaured as expected .

Explain:
1. the left side page with a filter in login page

Answer:
- The tinted left panel is just a hero card that frames the unified login as a campus-wide entry point. It holds future announcements, highlights, or help text while visually separating the credential form. There’s no extra logic tied to it—purely presentational to keep the experience branded and welcoming.

- After logout fall back always to `/auth/login/`.
- Remove the student/staff shortcuts from the portal header once automatic redirects cover all personas.

*** Role dashboards & required data (2025-11-09)
- Applicant landing: pulls `app.people.models.Applicant` (bio, contact, status) + `ApplicationDocument`. Needs a `status_history` table to show review milestones.
- Student dashboard: already wired to `Student`, `Registration`, `Section`, `Invoice`, `Payment`, `Grade`. Outstanding data: seat counts per section (expose `Section.capacity` + `Registration.status` filter), doc-upload audit trail.
- Instructor workspace: needs `Section` + `Grade` records scoped to `section.faculty`. Missing: explicit `FacultyProfile` (table?) linking `User` to `Instructor`.
# > For FacultyProfile lookin @people/models/faculty.py
- Chair curriculum console: relies on `Curriculum`, `CurriculumCourse`, `Prerequisite`, `FacultyAssignment`. Missing: workload metrics per faculty and misbehavior reports table.
# > Do not add a misbehavior yet will be handeled manualy
# > for workload metrics do add a table for historical audit reason too.  I mean to check who has been working extra in the past semester for example
- Dean oversight: needs curriculum imports (`import_export` logs), overload proposals (`WorkloadRequest` model TBD), department KPIs (aggregated registrations/payments).
# > ignore deparment KPI for now,  or let just a dean have his information page visible by all his faculties / students

- VPAA approvals hub: consumes overloads, prerequisite changes, and policy updates. Requires `ApprovalQueue` table capturing request type, payload, state transitions.
# > implement this approvalQueue

- Registrar lifecycle ops: data from `Registration`, `Grade`, `TranscriptRequest`, `Semester`, `StatusHistory`. Need `TranscriptRequest` model and registration anomaly flags.
# > implement TranscriptRequest
# > registration anomales should only be flagged on the fly on his dashboard, no table
- Scholarship office: `Donor`, `ScholarshipAward`, `ScholarshipLetter`, `Invoice`. Need GPA snapshots per term plus template metadata for mail merges.
# > make a proposal for this  
- Financial officer: `Invoice`, `Payment`, `FinancialHold`, `ScholarshipAward`. Need `Attachment` model for payment proofs and `HoldAudit`.
# >  the attachment can probably be integrated with the registry/models/document.py class

Dashboards to build after login:
1. Applicant portal (existing public pages).
2. Student dashboard (already prototyped).
3. Instructor, Chair, Dean, VPAA, Registrar, Scholarship Officer, Financial Officer cards -> dedicated `/staff/<role>/` screens.
# > yes do all of the above

Selenium smoke test idea:
- Script logs in (parameterized users), waits for redirect, asserts role-specific hero text/cards, tests logout, repeats for each role.
- Use `pytest-selenium` + fixtures that create fake users/groups + factories for required models.
# > implement the above  

Implementation plan:
1. Finalize data gaps (create missing models: `FacultyProfile`, `ApprovalQueue`, `ScholarshipLetterTemplate`, etc.).
2. Add staff router view that picks template based on highest-priority role.
3. Build templated dashboards incrementally (start with Registrar, Finance, Scholarship, Instructor) using shared card components.
# > agree for the above   
4. Seed sample data fixtures for Selenium tests; wire into CI.
# > We have real data in the DB for pass semester but we are missing a lot of data.  need to mockup upcomming semester data, reconduct curriculum and schedules
5. Implement Selenium suite covering login, redirect, dashboard key elements, and logout for each persona.
# > ok   

**** Progress 2025-11-09:
  - Added workload snapshots, approval queue, transcript requests, scholarship templates/snapshots, and document attachments (generic FK) so each dashboard has the required data sources.
  - Staff dashboards now live at `/staff/<role>/` with builders for instructor, chair, dean, VPAA, registrar, scholarship, finance, plus a general fallback.
  - Selenium suite `tests/selenium/test_portal_roles.py` logs in as every persona (student + all staff roles), asserts the expected heading, and verifies the logout redirect to `/auth/login/`.
